<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Testing with isolation: concepts and examples using the <a href="http://www.voidspace.org.uk/python/mock/">Python standard library <code>mock</code></a> <br> <i>Franklin Chen</i> <br> <i><a href="http://franklinchen.com/">http://franklinchen.com/</a></i> <br> <a href="http://www.meetup.com/pghpython/">Pittsburgh Python</a> <br> October 23, 2012</title>
    <!-- Styles -->
    
    <style type="text/css" media="print">
      * {
    margin: 0;
    padding: 0;
}

@page {
    size: landscape;
}

body {
    font: 100% "Lucida Grande", "Trebuchet MS", Verdana, sans-serif;
    padding: 0;
    margin: 0;
}

div.slide {
    min-width: 800px;
    min-height: 600px;
    padding: 1em;
    overflow: hidden;
    page-break-after: always;
    border: 1px solid black;
    border-radius: 20px;
}

div.slide div.inner {
    width: 800px;
    height: 600px;
    margin: auto;
    display: table-cell;
}

h1 {
    font-size: 2.4em;
}

h2 {
    font-size: 1.4em;
}

h3 {
    margin: 1em 0;
}

ul {
    margin: 0;
    padding: 0;
}

p, li, pre {
    margin: 1em 0;
}

li {
    margin-left: 2em;
}

a {
    color: #000000;
}

pre, code {
    max-width: 800px;
    background: #eee;
    font-family: Monaco, monospace;
    font-size: 90%;
}

pre {
    padding: .2em .5em;
    overflow: hidden;
    border-radius: .8em;
}

code {
    padding: 0 .2em;
}

.slide header:only-child h1 {
  line-height: 180%;
  text-align: center;
  display: table-cell;
  vertical-align: middle;
  height: 600px;
  width: 800px;
  font-size: 48px;
  margin-top:100px;
  margin-bottom:100px;
}

#toc, #help, .slide aside, .slide footer, .slide .notes,
.presenter_notes, #current_presenter_notes, #presenter_note {
  display: none;
}

    </style>
    <style type="text/css" media="screen, projection">
      body {
  font: 14px "Lucida Grande", "Trebuchet MS", Verdana, sans-serif;
  background: #778;
  padding: 0;
  margin: 0;
  overflow: hidden;
}

div.presentation {
  position: absolute;
  width: 100%;
  display: table-cell;
  vertical-align: middle;
  height: 100%;
  background: inherit;
}

div.presentation > h1 {
  display: none;
}

div.slides, body.expose div.slides.nocontext {
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  position: absolute;
  display: block;
}

div.slides.nocontext {
  width: 900px;
  margin: 0 auto;
  overflow: hidden;
  position: relative;
  left: auto;
  top: auto;
}

div.slide {
  display: inline;
  position: absolute;
  overflow: hidden;
  width: 900px;
  height: 700px;
  margin-top: -350px;
  margin-left: -400px;
  left: 50%;
  top: 50%;
  background: -webkit-gradient(linear, left bottom, left top, from(#bbd), to(#fff));
  background-color: #eee;
  background: -moz-linear-gradient(bottom, #bbd, #fff);
  -webkit-transition: margin 0.25s ease-in-out;
  -moz-transition: margin 0.25s ease-in-out;
  -o-transition: margin 0.25s ease-in-out;
  border-top-left-radius: 20px;
  -moz-border-radius-topleft: 20px;
  -webkit-border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  -moz-border-radius-topright: 20px;
  -webkit-border-top-right-radius: 20px;
  border-bottom-right-radius: 20px;
  -moz-border-radius-bottomright: 20px;
  -webkit-border-bottom-right-radius: 20px;
  border-bottom-left-radius: 20px;
  -moz-border-radius-bottomleft: 20px;
  -webkit-border-bottom-left-radius: 20px;
}

/* Expose */

body.expose div.slides {
  float: left;
  position: relative;
  overflow: auto;
  margin-bottom: 10px;
}

body.expose div.slide {
  display: block;
  float: left;
  position: relative;
  left: auto !important;
  top: auto !important;
  margin: 10px !important;
  -webkit-transition: none;
  -moz-transition: none;
  -o-transition: none;
  -moz-transform: scale(.33, .33);
  -moz-transform-origin: 0 0;
  -webkit-transform: scale(.33, .33);
  -webkit-transform-origin: 0 0;
  -o-transform: scale(.33, .33);
  -o-transform-origin: 0 0;
  -webkit-transition: none;
  -moz-transition: none;
  -o-transition: none;
  cursor: pointer;
}

body.expose div.slide:hover {
  background: -webkit-gradient(linear, left bottom, left top, from(#bdd), to(#fff));
  background-color: #eee;
  background: -moz-linear-gradient(bottom, #bdd, #fff);
}

body.expose .slide-wrapper {
  float: left;
  position: relative;
  margin: .5%;
  width: 300px;
  height: 233px;
}

body.expose .slide footer {
}

body.expose .slide .inner {
}

body.expose .slide.far-past,
body.expose .slide.past,
body.expose .slide.future,
body.expose .slide.far-future {
  margin-left: 0;
}

body.expose .slide.current {
  background: -webkit-gradient(linear, left bottom, left top, from(#ddb), to(#fff));
  background-color: #eee;
  background: -moz-linear-gradient(bottom, #ddb, #fff);
  border: 16px solid #fff;
  -moz-transform: scale(.315, .315);
  -moz-transform-origin: 0 0;
  -webkit-transform: scale(.315, .315);
  -webkit-transform-origin: 0 0;
  -o-transform: scale(.315, .315);
  -o-transform-origin: 0 0;
}

/* Presenter Mode */

body.presenter_view div.slide {
  display: inline;
  position: absolute;
  overflow: hidden;
  -moz-transform: scale(.5, .5);
  -moz-transform-origin: 0 0;
  -webkit-transform: scale(.5, .5);
  -webkit-transform-origin: 0 0;
  -o-transform: scale(.5, .5);
  -o-transform-origin: 0 0;
    margin-top: -300px;
}

body.presenter_view .slide.far-past {
  display: block;
  margin-left: -1500px;
}

body.presenter_view .slide.past {
  display: block;
  margin-left: -975px;
}

body.presenter_view .slide.current {
  display: block;
  margin-left: -475px;
  border: 8px solid maroon;
  z-index: 2;
}

body.presenter_view .slide.future {
  display: block;
  margin-left: 25px;
  z-index: 1;
}

body.presenter_view .slide.far-future {
  display: block;
  margin-left: 525px;
}

body.presenter_view div#current_presenter_notes {
    visibility: visible;
    display: block;
    position: absolute;
    overflow: auto;
    vertical-align: middle;
    left: 50%;
    top: 50%;
    margin-left: -475px;
    margin-top: 100px;
    z-index: 2;
    width: 950px;
    border-style: solid;
    height: 30%;
    background-color: silver;
}

body.presenter_view div#current_presenter_notes section {
  font-family: "Lucida Grande", "Trebuchet MS", Verdana, sans-serif;
  color: black;
  text-shadow: rgba(0, 0, 0, 0.2) 0 2px 5px;
  display: block;
  overflow: visible;
    position: relative;
    background-color: #fffeff;
    height: 120px;
    margin-right: 30px;
    margin-top: 60px;
    margin-left: 30px;
    padding-right: 10px;
    padding-left: 10px;
    padding-top: 10px;
}

body.presenter_view div#current_presenter_notes section p {
    margin: 0;
}

body.presenter_view div#current_presenter_notes h1 {
    font-size: 50%;
    display: block;
}

div#current_presenter_notes {
  display: none;
}

div.slide div.presenter_notes, div.slides div.presenter_notes {
  display: none;
}

/* Slide styles */

div.slide p {
  font-size: 20px;
}

.slide.far-past {
  display: block;
  margin-left: -2400px;
}

.slide.past {
  display: block;
  margin-left: -1400px;
}

.slide.current {
  display: block;
  margin-left: -450px;
}

.slide.future {
  display: block;
  margin-left: 500px;
}

.slide.far-future {
  display: block;
  margin-left: 1500px;
}

body.three-d div.slides {
  -webkit-transform: translateX(50px) scale(0.8) rotateY(10deg);
  -moz-transform: translateX(50px) scale(0.8) rotateY(10deg);
  -o-transform: translateX(50px) scale(0.8) rotateY(10deg);
}


/* Content */

header:not(:only-child) {
  font-family: "Lucida Grande", "Trebuchet MS", Verdana, sans-serif;
  font-weight: normal;
  font-size: 50px;
  letter-spacing: -.05em;
  color: black;
  text-shadow: rgba(0, 0, 0, 0.2) 0 2px 5px;
  position: absolute;
  left: 30px;
  top: 25px;
  margin: 0;
  padding: 0;
}

header h1, header h2, header h3, header h4, header h5, header h6 {
  display: inline;
  font-size: 100%;
  font-weight: normal;
  padding: 0;
  margin: 0;
}

header h2:first-child {
  margin-top: 0;
}

section, .slide header:only-child h1 {
  font-family: "Lucida Grande", "Trebuchet MS", Verdana, sans-serif;
  color: #3f3f3f;
  text-shadow: rgba(0, 0, 0, 0.2) 0 2px 5px;
  margin-left: 30px;
  margin-right: 30px;
  margin-top: 100px;
  display: block;
  overflow: hidden;
}

img { display: block; margin: auto; }

section img.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

section img.align-right {
  display: block;
  margin-left: auto;
  margin-right: 0;
}

section img.align-left {
  display: block;
  margin-right: auto;
  margin-left: 0;
}

a {
  color: inherit;
  display: inline-block;
  text-decoration: none;
  line-height: 110%;
  border-bottom: 2px solid #3f3f3f;
}

pre {
  font-size: 16px;
  font-family: Monaco, Courier, monospace;
}

li {
  padding: 10px 0;
  font-size: 20px;
}

.slide header:only-child h1 {
  line-height: 180%;
  text-align: center;
  display: table-cell;
  vertical-align: middle;
  height: 700px;
  width: 900px;
  font-size: 50px;
  margin-top:100px;
  margin-bottom:100px;
}

.sidebar {
  clear: both;
  background: -webkit-gradient(linear, top right, bottom right, from(#dde), to(#fff));
  -webkit-transition: margin 0.25s ease-in-out;
  background-color: #eee;
  background: -moz-linear-gradient(right, #dde, #fff);
  border-right: 5px solid #ccd;
  z-index: 9999999;
  height: 100%;
  overflow: hidden;
  top: 0;
  position: absolute;
  display: block;
  margin: 0;
  margin-left: -400px;
  padding: 10px 16px;
  overflow: auto;
  -webkit-transition: margin 0.2s ease-in-out;
  -moz-transition: margin 0.2s ease-in-out;
  -o-transition: margin 0.2s ease-in-out;
}

.sidebar h2 {
  text-shadow: rgba(0, 0, 0, 0.2) 0 2px 5px;
  margin: 0 0 16px;
  padding: 0;
}

.sidebar table {
  width: 100%;
  margin: 0;
  padding: 0;
  border-collapse: collapse;
}

.sidebar table caption {
  display: none;
}

.sidebar tr {
  margin: 2px 0;
  border-bottom: 1px solid #ccc;
}

.sidebar th {
  text-align: left;
  font-weight: normal;
  max-width: 300px;
  overflow: hidden;
}

.sidebar tr.sub th {
  text-indent: 20px;
}

.sidebar td {
  text-align: right;
  min-width: 20px;
}

.sidebar a {
  display: block;
  text-decoration: none;
  border-bottom: none;
  padding: 4px 0;
}

.sidebar tr.active {
  background: #ff0;
}

aside {
  display: none;
}
  aside.source {
    position: absolute;
    bottom: 6px;
    left: 10px;
    text-indent: 10px;
  }
  aside.page_number {
    position: absolute;
    bottom: 6px;
    right: 10px;
    text-indent: 10px;
  }

.notes {
  display: none;
  padding: 10px;
  background: #ccc;
  border-radius: 10px;
  -moz-border-radius: 10px;
  -webkit-border-radius: 10px;
}
  div.slide p.notes {
    font-size: 90%;
}

/* Pygments default theme */
.hll { background-color: #ffffcc }
.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #808080 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0040D0 } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.il { color: #666666 } /* Literal.Number.Integer.Long */

#blank {
  position: absolute;
  top: 0;
  left: 0;
  background-color: black;
  width: 100%;
  height: 100%;
  z-index: 64;
  display: none;
}

    </style>
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script>
      function main() {
    // Since we don't have the fallback of attachEvent and
    // other IE only stuff we won't try to run JS for IE.
    // It will run though when using Google Chrome Frame
    if (document.all) { return; }

    var currentSlideNo;
    var notesOn = false;
    var expanded = false;
    var hiddenContext = false;
    var blanked = false;
    var slides = document.getElementsByClassName('slide');
    var touchStartX = 0;
    var spaces = /\s+/, a1 = [''];
    var tocOpened = false;
    var helpOpened = false;
    var overviewActive = false;
    var modifierKeyDown = false;
    var scale = 1;
    var showingPresenterView = false;
    var presenterViewWin = null;
    var isPresenterView = false;

    var str2array = function(s) {
        if (typeof s == 'string' || s instanceof String) {
            if (s.indexOf(' ') < 0) {
                a1[0] = s;
                return a1;
            } else {
                return s.split(spaces);
            }
        }
        return s;
    };

    var trim = function(str) {
        return str.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
    };

    var addClass = function(node, classStr) {
        classStr = str2array(classStr);
        var cls = ' ' + node.className + ' ';
        for (var i = 0, len = classStr.length, c; i < len; ++i) {
            c = classStr[i];
            if (c && cls.indexOf(' ' + c + ' ') < 0) {
                cls += c + ' ';
            }
        }
        node.className = trim(cls);
    };

    var removeClass = function(node, classStr) {
        var cls;
        if (!node) {
            throw 'no node provided';
        }
        if (classStr !== undefined) {
            classStr = str2array(classStr);
            cls = ' ' + node.className + ' ';
            for (var i = 0, len = classStr.length; i < len; ++i) {
                cls = cls.replace(' ' + classStr[i] + ' ', ' ');
            }
            cls = trim(cls);
        } else {
            cls = '';
        }
        if (node.className != cls) {
            node.className = cls;
        }
    };

    var getSlideEl = function(slideNo) {
        if (slideNo > 0) {
            return slides[slideNo - 1];
        } else {
            return null;
        }
    };

    var getSlideTitle = function(slideNo) {
        var el = getSlideEl(slideNo);
        if (el) {
            var headers = el.getElementsByTagName('header');
            if (headers.length > 0) {
                return el.getElementsByTagName('header')[0].innerText;
            }
        }
        return null;
    };

    var getSlidePresenterNote = function(slideNo) {
        var el = getSlideEl(slideNo);
        if (el) {
            var n = el.getElementsByClassName('presenter_notes');
            if (n.length > 0) {
                return n[0];
            }
        }
        return null;
    };

    var changeSlideElClass = function(slideNo, className) {
        var el = getSlideEl(slideNo);
        if (el) {
            removeClass(el, 'far-past past current future far-future');
            addClass(el, className);
        }
    };

    var updateSlideClasses = function(updateOther) {
        window.location.hash = (isPresenterView ? "presenter" : "slide") + currentSlideNo;

        for (var i=1; i<currentSlideNo-1; i++) {
            changeSlideElClass(i, 'far-past');
        }

        changeSlideElClass(currentSlideNo - 1, 'past');
        changeSlideElClass(currentSlideNo, 'current');
        changeSlideElClass(currentSlideNo + 1, 'future');

        for (i=currentSlideNo+2; i<slides.length+1; i++) {
            changeSlideElClass(i, 'far-future');
        }

        highlightCurrentTocLink();

        processContext();

        document.getElementsByTagName('title')[0].innerText = getSlideTitle(currentSlideNo);

        updatePresenterNotes();

        if (updateOther) { updateOtherPage(); }
    };

    var updatePresenterNotes = function() {
        if (!isPresenterView) { return; }

        var existingNote = document.getElementById('current_presenter_notes');
        var currentNote = getSlidePresenterNote(currentSlideNo).cloneNode(true);
        currentNote.setAttribute('id', 'presenter_note');

        existingNote.replaceChild(currentNote, document.getElementById('presenter_note'));
    };

    var highlightCurrentTocLink = function() {
        var toc = document.getElementById('toc');

        if (toc) {
            var tocRows = toc.getElementsByTagName('tr');
            for (var i=0; i<tocRows.length; i++) {
                removeClass(tocRows.item(i), 'active');
            }

            var currentTocRow = document.getElementById('toc-row-' + currentSlideNo);
            if (currentTocRow) {
                addClass(currentTocRow, 'active');
            }
        }
    };

    var updateOtherPage = function() {
        if (!showingPresenterView) { return; }

        var w = isPresenterView ? window.opener : presenterViewWin;
        w.postMessage('slide#' + currentSlideNo, '*');
    };

    var nextSlide = function() {
        if (currentSlideNo < slides.length) {
            currentSlideNo++;
        }
        updateSlideClasses(true);
    };

    var prevSlide = function() {
        if (currentSlideNo > 1) {
            currentSlideNo--;
        }
        updateSlideClasses(true);
    };

    var showNotes = function() {
        var notes = getSlideEl(currentSlideNo).getElementsByClassName('notes');
        for (var i = 0, len = notes.length; i < len; i++) {
            notes.item(i).style.display = (notesOn) ? 'none':'block';
        }
        notesOn = !notesOn;
    };

    var showSlideNumbers = function() {
        var asides = document.getElementsByClassName('page_number');
        var hidden = asides[0].style.display != 'block';
        for (var i = 0; i < asides.length; i++) {
            asides.item(i).style.display = hidden ? 'block' : 'none';
        }
    };

    var showSlideSources = function() {
        var asides = document.getElementsByClassName('source');
        var hidden = asides[0].style.display != 'block';
        for (var i = 0; i < asides.length; i++) {
            asides.item(i).style.display = hidden ? 'block' : 'none';
        }
    };

    var showToc = function() {
        if (helpOpened) {
                showHelp();
        }
        var toc = document.getElementById('toc');
        if (toc) {
            toc.style.marginLeft = tocOpened ? '-' + (toc.clientWidth + 20) + 'px' : '0px';
            tocOpened = !tocOpened;
        }
        updateOverview();
    };

    var showHelp = function() {
        if (tocOpened) {
                showToc();
        }

        var help = document.getElementById('help');

        if (help) {
            help.style.marginLeft = helpOpened ? '-' + (help.clientWidth + 20) + 'px' : '0px';
            helpOpened = !helpOpened;
        }
    };

    var showPresenterView = function() {
        if (isPresenterView) { return; }

        if (showingPresenterView) {
            presenterViewWin.close();
            presenterViewWin = null;
            showingPresenterView = false;
        } else {
            presenterViewWin = open(window.location.pathname + "#presenter" + currentSlideNo, 'presenter_notes',
                                                                    'directories=no,location=no,toolbar=no,menubar=no,copyhistory=no');
            showingPresenterView = true;
        }
    };

    var switch3D = function() {
        if (document.body.className.indexOf('three-d') == -1) {
            document.getElementsByClassName('presentation')[0].style.webkitPerspective = '1000px';
            document.body.className += ' three-d';
        } else {
            window.setTimeout('document.getElementsByClassName(\'presentation\')[0].style.webkitPerspective = \'0\';', 2000);
            document.body.className = document.body.className.replace(/three-d/, '');
        }
    };

    var toggleOverview = function() {
        if (!overviewActive) {
            addClass(document.body, 'expose');
            overviewActive = true;
            setScale(1);
        } else {
            removeClass(document.body, 'expose');
            overviewActive = false;
            if (expanded) {
                setScale(scale);    // restore scale
            }
        }
        processContext();
        updateOverview();
    };

    var updateOverview = function() {
        try {
            var presentation = document.getElementsByClassName('presentation')[0];
        } catch (e) {
            return;
        }

        if (isPresenterView) {
            var action = overviewActive ? removeClass : addClass;
            action(document.body, 'presenter_view');
        }

        var toc = document.getElementById('toc');

        if (!toc) {
            return;
        }

        if (!tocOpened || !overviewActive) {
            presentation.style.marginLeft = '0px';
            presentation.style.width = '100%';
        } else {
            presentation.style.marginLeft = toc.clientWidth + 'px';
            presentation.style.width = (presentation.clientWidth - toc.clientWidth) + 'px';
        }
    };

    var computeScale = function() {
        var cSlide = document.getElementsByClassName('current')[0];
        var sx = cSlide.clientWidth / window.innerWidth;
        var sy = cSlide.clientHeight / window.innerHeight;
        return 1 / Math.max(sx, sy);
    };

    var setScale = function(scale) {
        var presentation = document.getElementsByClassName('slides')[0];
        var transform = 'scale(' + scale + ')';
        presentation.style.MozTransform = transform;
        presentation.style.WebkitTransform = transform;
        presentation.style.OTransform = transform;
        presentation.style.msTransform = transform;
        presentation.style.transform = transform;
    };

    var expandSlides = function() {
        if (overviewActive) {
            return;
        }
        if (expanded) {
            setScale(1);
            expanded = false;
        } else {
            scale = computeScale();
            setScale(scale);
            expanded = true;
        }
    };

    var showContext = function() {
        try {
            var presentation = document.getElementsByClassName('slides')[0];
            removeClass(presentation, 'nocontext');
        } catch (e) {}
    };

    var hideContext = function() {
        try {
            var presentation = document.getElementsByClassName('slides')[0];
            addClass(presentation, 'nocontext');
        } catch (e) {}
    };

    var processContext = function() {
        if (hiddenContext) {
            hideContext();
        } else {
            showContext();
        }
    };

    var toggleContext = function() {
        hiddenContext = !hiddenContext;
        processContext();
    };

    var toggleBlank = function() {
        blank_elem = document.getElementById('blank');

        blank_elem.style.display = blanked ? 'none' : 'block';

        blanked = !blanked;
    };

    var isModifierKey = function(keyCode) {
        switch (keyCode) {
            case 16: // shift
            case 17: // ctrl
            case 18: // alt
            case 91: // command
                return true;
                break;
            default:
                return false;
                break;
        }
    };

    var checkModifierKeyUp = function(event) {
        if (isModifierKey(event.keyCode)) {
            modifierKeyDown = false;
        }
    };

    var checkModifierKeyDown = function(event) {
        if (isModifierKey(event.keyCode)) {
            modifierKeyDown = true;
        }
    };

    var handleBodyKeyDown = function(event) {
        switch (event.keyCode) {
            case 13: // Enter
                if (overviewActive) {
                    toggleOverview();
                }
                break;
            case 27: // ESC
                toggleOverview();
                break;
            case 37: // left arrow
            case 33: // page up
                event.preventDefault();
                prevSlide();
                break;
            case 39: // right arrow
            case 32: // space
            case 34: // page down
                event.preventDefault();
                nextSlide();
                break;
            case 50: // 2
                if (!modifierKeyDown) {
                        showNotes();
                }
                break;
            case 51: // 3
                if (!modifierKeyDown && !overviewActive) {
                    switch3D();
                }
                break;
            case 190: // .
            case 48: // 0
            case 66: // b
                if (!modifierKeyDown && !overviewActive) {
                    toggleBlank();
                }
                break;
            case 67: // c
                if (!modifierKeyDown && !overviewActive) {
                    toggleContext();
                }
                break;
            case 69: // e
                if (!modifierKeyDown && !overviewActive) {
                    expandSlides();
                }
                break;
            case 72: // h
                showHelp();
                break;
            case 78: // n
                if (!modifierKeyDown && !overviewActive) {
                    showSlideNumbers();
                }
                break;
            case 80: // p
                if (!modifierKeyDown && !overviewActive) {
                    showPresenterView();
                }
                break;
            case 83: // s
                if (!modifierKeyDown && !overviewActive) {
                    showSlideSources();
                }
                break;
            case 84: // t
                showToc();
                break;
        }
    };

    var handleWheel = function(event) {
        if (tocOpened || helpOpened || overviewActive) {
            return;
        }

        var delta = 0;

        if (!event) {
            event = window.event;
        }

        if (event.wheelDelta) {
            delta = event.wheelDelta/120;
            if (window.opera) delta = -delta;
        } else if (event.detail) {
            delta = -event.detail/3;
        }

        if (delta && delta <0) {
            nextSlide();
        } else if (delta) {
            prevSlide();
        }
    };

    var addSlideClickListeners = function() {
        for (var i=0; i < slides.length; i++) {
            var slide = slides.item(i);
            slide.num = i + 1;
            slide.addEventListener('click', function(e) {
                if (overviewActive) {
                    currentSlideNo = this.num;
                    toggleOverview();
                    updateSlideClasses(true);
                    e.preventDefault();
                }
                return false;
            }, true);
        }
    };

    var addRemoteWindowControls = function() {
        window.addEventListener("message", function(e) {
            if (e.data.indexOf("slide#") != -1) {
                    currentSlideNo = Number(e.data.replace('slide#', ''));
                    updateSlideClasses(false);
            }
        }, false);
    };

    var addTouchListeners = function() {
        document.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].pageX;
        }, false);
        document.addEventListener('touchend', function(e) {
            var pixelsMoved = touchStartX - e.changedTouches[0].pageX;
            var SWIPE_SIZE = 150;
            if (pixelsMoved > SWIPE_SIZE) {
                nextSlide();
            }
            else if (pixelsMoved < -SWIPE_SIZE) {
             prevSlide();
            }
        }, false);
    };

    var addTocLinksListeners = function() {
        var toc = document.getElementById('toc');
        if (toc) {
            var tocLinks = toc.getElementsByTagName('a');
            for (var i=0; i < tocLinks.length; i++) {
                tocLinks.item(i).addEventListener('click', function(e) {
                    currentSlideNo = Number(this.attributes['href'].value.replace('#slide', ''));
                    updateSlideClasses(true);
                    e.preventDefault();
                }, true);
            }
        }
    };

    // initialize

    (function() {
        if (window.location.hash == "") {
            currentSlideNo = 1;
        } else if (window.location.hash.indexOf("#presenter") != -1) {
            currentSlideNo = Number(window.location.hash.replace('#presenter', ''));
            isPresenterView = true;
            showingPresenterView = true;
            presenterViewWin = window;
            addClass(document.body, 'presenter_view');
        } else {
            currentSlideNo = Number(window.location.hash.replace('#slide', ''));
        }

        document.addEventListener('keyup', checkModifierKeyUp, false);
        document.addEventListener('keydown', handleBodyKeyDown, false);
        document.addEventListener('keydown', checkModifierKeyDown, false);
        document.addEventListener('DOMMouseScroll', handleWheel, false);

        window.onmousewheel = document.onmousewheel = handleWheel;
        window.onresize = expandSlides;

        for (var i = 0, el; el = slides[i]; i++) {
            addClass(el, 'slide far-future');
        }
        updateSlideClasses(false);

        // add support for finger events (filter it by property detection?)
        addTouchListeners();

        addTocLinksListeners();

        addSlideClickListeners();

        addRemoteWindowControls();
    })();
}

    </script>
    
    
    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Testing with isolation: concepts and examples using the <a href="http://www.voidspace.org.uk/python/mock/">Python standard library <code>mock</code></a> <br> <i>Franklin Chen</i> <br> <i><a href="http://franklinchen.com/">http://franklinchen.com/</a></i> <br> <a href="http://www.meetup.com/pghpython/">Pittsburgh Python</a> <br> October 23, 2012</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              1/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Why this talk?</h1></header>
            
            
            <section><h1>"The best way to learn something is to teach it."</h1>
<ul>
<li>resistance</li>
<li>confusion</li>
<li>understanding</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              2/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Mocks: controversial</h1></header>
            
            
            <section><h1><a href="http://www.confreaks.com/videos/659-rubyconf2011-why-you-don-t-get-mock-objects">Gregory Moeck: "Why You Don't Get Mock Objects", RubyConf 2011</a></h1>
<ul>
<li>advocates correct use of mocks</li>
<li>(examples in Ruby)</li>
</ul>
<h1><a href="http://martinfowler.com/articles/mocksArentStubs.html">Martin Fowler: "Mocks Aren't Stubs"</a>, 2007</h1>
<ul>
<li>objective comparison</li>
<li>himself chooses not to use mocks</li>
<li>(examples in Java)</li>
</ul>
<h1><a href="http://www.martinfowler.com/articles/modernMockingTools.html">Brett Schuchert: "Modern Mocking Tools and Black Magic"</a>, September 2012</h1>
<ul>
<li>the power of mocking tools, but dangers</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              3/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Outline of presentation</h1></header>
            
            
            <section><ul>
<li>basic concepts in testing</li>
<li>what is a mock anyway?</li>
<li>types of test doubles</li>
<li>using mocks</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              4/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Types of tests</h1></header>
            
            
            <section><h1>Terminology</h1>
<p>Gerard Meszaros's, "xUnit Test Patterns", 2007.</p>
<p>"System under test" (SUT)</p>
<h1>Different scopes</h1>
<ul>
<li>acceptance test</li>
<li>integration test</li>
<li>unit test</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              5/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Focus on unit testing</h1></header>
            
            
            <section><p>Scope: class or module</p>
<ul>
<li>arrange</li>
<li>act</li>
<li>assert</li>
</ul>
<p><a href="http://docs.python.org/library/unittest.html"><code>unittest</code></a>: test framework included in Python standard library</p>
<p><a href="http://wiki.python.org/moin/PythonTestingToolsTaxonomy">Many others exist.</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              6/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1><code>unittest</code> example</h1></header>
            
            
            <section><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">our_module</span>

<span class="k">class</span> <span class="nc">TestOurModule</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_our_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Our addition function should work on 2 and 3.&quot;&quot;&quot;</span>

        <span class="c"># arrange</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="c"># act; assert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">our_module</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">expected_result</span><span class="p">)</span>

    <span class="c"># Another test in same test case.</span>
    <span class="k">def</span> <span class="nf">test_our_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Our multiply function should work on 3 and 4.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">our_module</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              7/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Running the unit test</h1></header>
            
            
            <section><p>(Assume Python 2.7 or higher, for nice test discovery features.)</p>
<div class="highlight"><pre><span class="gp">$</span> python -m unittest discover
</pre></div>

<p>Oops, where is <code>our_module</code>?</p>
<div class="highlight"><pre><span class="go">E</span>
<span class="go">======================================================================</span>
<span class="go">ERROR: test_our_module (unittest.loader.ModuleImportFailure)</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">ImportError: Failed to import test module: test_our_module</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;/usr/local/Cellar/python/2.7.3/lib/python2.7/unittest/loader.py&quot;, line 252, in _find_tests</span>
<span class="go">    module = self._get_module_from_name(name)</span>
<span class="go">  File &quot;/usr/local/Cellar/python/2.7.3/lib/python2.7/unittest/loader.py&quot;, line 230, in _get_module_from_name</span>
<span class="go">    __import__(name)</span>
<span class="go">  File &quot;/Users/chen/Dropbox/pghpython/2012-10-24/talk-on-python-mock/test_our_module.py&quot;, line 2, in &lt;module&gt;</span>
<span class="go">    import our_module</span>
<span class="go">ImportError: No module named our_module</span>

<span class="go">----------------------------------------------------------------------</span>
<span class="go">Ran 1 test in 0.000s</span>

<span class="go">FAILED (errors=1)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              8/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1><a href="http://en.wikipedia.org/wiki/Test-driven_development">Test-driven development (TDD)</a></h1></header>
            
            
            <section><p>Our test case <code>test_our_module</code> failed because we had not yet written <code>our_module.py</code> at all!</p>
<p>This is <em>on purpose</em>.</p>
<ul>
<li>write test first</li>
<li>see test fail</li>
<li>write code to make test succeed</li>
<li>repeat</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              9/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Implementing our module</h1></header>
            
            
            <section><p>Creating <code>our_module.py</code>:</p>
<div class="highlight"><pre><span class="c"># Note: this is deliberately buggy!</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return sum of x and y using clever algorithm.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              10/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Rerunning tests</h1></header>
            
            
            <section><div class="highlight"><pre><span class="gp">$</span> python -m unittest discover
<span class="go">FE</span>
<span class="go">======================================================================</span>
<span class="go">ERROR: test_our_multiply (test_our_module.TestOurModule)</span>
<span class="go">Our multiply function should work on 3 and 4.</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;/Users/chen/Dropbox/pghpython/2012-10-24/talk-on-python-mock/test_our_module.py&quot;, line 20, in test_our_multiply</span>
<span class="go">    self.assertEqual(our_module.multiply(3, 4), 12)</span>
<span class="go">AttributeError: &#39;module&#39; object has no attribute &#39;multiply&#39;</span>

<span class="go">======================================================================</span>
<span class="go">FAIL: test_our_add (test_our_module.TestOurModule)</span>
<span class="go">Our addition function should work on 2 and 3.</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;/Users/chen/Dropbox/pghpython/2012-10-24/talk-on-python-mock/test_our_module.py&quot;, line 14, in test_our_add</span>
<span class="go">    self.assertEqual(our_module.add(x, y), expected_result)</span>
<span class="go">AssertionError: 6 != 5</span>

<span class="go">----------------------------------------------------------------------</span>
<span class="go">Ran 2 tests in 0.000s</span>

<span class="go">FAILED (failures=1, errors=1)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              11/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Skipping tests</h1></header>
            
            
            <section><p>We want to focus <em>only</em> on <code>test_our_add</code> for now, so mark <code>test_our_multiply</code> as <strong>skipped</strong> for now:</p>
<div class="highlight"><pre>    <span class="nd">@unittest.skip</span><span class="p">(</span><span class="s">&quot;Not working on multiply till add works&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_our_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Our multiply function should work on 3 and 4.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">our_module</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>

<p>Rerun:</p>
<div class="highlight"><pre><span class="gp">$</span> python -m unittest discover
<span class="go">Fs</span>
<span class="go">======================================================================</span>
<span class="go">FAIL: test_our_add (test_our_module.TestOurModule)</span>
<span class="go">Our addition function should work on 2 and 3.</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;/Users/chen/Dropbox/pghpython/2012-10-24/talk-on-python-mock/test_our_module.py&quot;, line 14, in test_our_add</span>
<span class="go">    self.assertEqual(our_module.add(x, y), expected_result)</span>
<span class="go">AssertionError: 6 != 5</span>

<span class="go">----------------------------------------------------------------------</span>
<span class="go">Ran 2 tests in 0.000s</span>

<span class="go">FAILED (failures=1, skipped=1)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              12/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Fixing the bug</h1></header>
            
            
            <section><div class="highlight"><pre><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return sum of x and y using clever algorithm.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>

<p>Rerun:</p>
<div class="highlight"><pre><span class="gp">$</span> python -m unittest discover
<span class="go">.s</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Ran 2 tests in 0.000s</span>

<span class="go">OK (skipped=1)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              13/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Repeat process: do <code>multiply</code></h1></header>
            
            
            <section><ul>
<li>remove <code>@unittest.skip</code> decorator from <code>test_our_multiply</code></li>
<li>rerun test case to fail again</li>
<li>implement <code>our_module.multiply</code></li>
<li>rerun test case for complete success</li>
</ul>
<p>Success!</p>
<div class="highlight"><pre><span class="gp">$</span> python -m unittest discover
<span class="go">..</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Ran 2 tests in 0.000s</span>

<span class="go">OK</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              14/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>What are test doubles?</h1></header>
            
            
            <section><p>A <em>test double</em> is anything that stands in for a real thing: <a href="http://xunitpatterns.com/Test%20Double.html">terminology by Meszaros, used by Fowler</a></p>
<h1>dummy object</h1>
<ul>
<li>passed around, never used</li>
</ul>
<h1>test stub</h1>
<ul>
<li>control indirect inputs of SUT: canned answers</li>
</ul>
<h1>test spy</h1>
<ul>
<li>control indirect inputs; <em>record</em> to verify indirect outputs of SUT</li>
</ul>
<h1>mock object</h1>
<ul>
<li>verify indirect outputs of SUT, by setting up <em>expectations</em> (of calls, etc.), then <em>verifying</em></li>
</ul>
<h1>fake object</h1>
<ul>
<li>use same interface, but alternate implementation of an object</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              15/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Introduction to Python <code>mock</code></h1></header>
            
            
            <section><h1>Installation</h1>
<ul>
<li>Python 3.3: part of standard library as <code>unittest.mock</code></li>
<li>Python 2.7: install with <code>easy_install</code> or <code>pip</code></li>
</ul>
<h1>Terminology</h1>
<p>Technically, the <code>mock</code> library provides a <em>test spy</em> rather than a <em>mock</em>!</p>
<p><a href="http://www.voidspace.org.uk/python/mock/#terminology">Michael Foord, creator of <code>mock</code>, on terminology</a>:</p>
<blockquote>
<p><code>mock.Mock()</code> is capable of being used in most of the different roles described by Fowler, except (annoyingly / frustratingly / ironically) a Mock itself!</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              16/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Basic ideas of <code>mock</code></h1></header>
            
            
            <section><p>Create a mock; author says it makes sense to use <code>MagicMock</code> in place of original <code>Mock</code> since <code>MagicMock</code> is more capable:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mock</span> <span class="kn">import</span> <span class="n">MagicMock</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
</pre></div>

<p>Use the mock; actions are recorded internally:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s">&quot;everything&quot;</span><span class="p">)</span>
</pre></div>

<p>Make an assertion that fails:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s">&quot;something&quot;</span><span class="p">,</span> <span class="s">&quot;else&quot;</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s">&quot;/usr/local/Cellar/python/2.7.3/lib/python2.7/site-packages/mock.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">835</span><span class="p">,</span> <span class="ow">in</span> <span class="n">assert_called_once_with</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">&quot;/usr/local/Cellar/python/2.7.3/lib/python2.7/site-packages/mock.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">824</span><span class="p">,</span> <span class="ow">in</span> <span class="n">assert_called_with</span>
    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="ne">AssertionError</span><span class="p">:</span> <span class="n">Expected</span> <span class="n">call</span><span class="p">:</span> <span class="n">mock</span><span class="p">(</span><span class="s">&#39;something&#39;</span><span class="p">,</span> <span class="s">&#39;else&#39;</span><span class="p">)</span>
<span class="n">Actual</span> <span class="n">call</span><span class="p">:</span> <span class="n">mock</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s">&#39;everything&#39;</span><span class="p">)</span>
</pre></div>

<p>Make an assertion that succeeds (silently):</p>
<pre><code>&gt;&gt;&gt; m.assert_called_once_with(42, "everything")
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              17/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>More examples of spying</h1></header>
            
            
            <section><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">mock</span> <span class="kn">import</span> <span class="n">MagicMock</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Not called yet</span>
<span class="o">...</span> <span class="n">m</span><span class="o">.</span><span class="n">called</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Make three calls</span>
<span class="o">...</span> <span class="n">m</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">MagicMock</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;mock()&#39;</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;4300782544&#39;</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">MagicMock</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;mock()&#39;</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;4300782544&#39;</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span> <span class="s">&quot;world&quot;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">MagicMock</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;mock()&#39;</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;4300782544&#39;</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Number of calls made</span>
<span class="o">...</span> <span class="n">m</span><span class="o">.</span><span class="n">call_count</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Assert whether ever called with (2, 3)?</span>
<span class="o">...</span> <span class="n">m</span><span class="o">.</span><span class="n">assert_any_call</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># the exact sequence of all calls</span>
<span class="o">...</span> <span class="n">m</span><span class="o">.</span><span class="n">mock_calls</span>
<span class="p">[</span><span class="n">call</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">call</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> <span class="n">call</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;world&#39;</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Set return value for the next call</span>
<span class="o">...</span> <span class="n">m</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s">&quot;yes&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="p">(</span><span class="mi">52</span><span class="p">)</span>
<span class="s">&#39;yes&#39;</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              18/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Controlled patching</h1></header>
            
            
            <section><p><code>mock</code> provides many ways to <em>patch</em> out a real object by a fake one.</p>
<p>Especially useful: <em>context managers</em> and <em>decorators</em></p>
<ul>
<li>limit the scope of patching</li>
<li>restore everything after exiting scope</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              19/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Testing behavior without patching</h1></header>
            
            
            <section><p>Assume: we have <code>double</code> in <code>our_module</code>:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return double x.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

<h2>New requirement from customer: no use of multiplication when doubling!</h2>
<h2>How write a test to express this <em>behavioral</em> requirement?</h2>
<p>Without a mocking framework, tricky.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              20/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>A terrible solution</h1></header>
            
            
            <section><ul>
<li>create a <strong>global variable</strong> <code>multiply_count</code>, initialized to <code>0</code></li>
<li><strong>modify</strong> code for <code>our_module.multiply</code> to increment <code>multiply_count</code> on each call</li>
<li>write test to call <code>double</code> and then assert on the <em>state</em> <code>multiply_count</code> being <code>0</code></li>
<li>uh, undo the source code change</li>
</ul>
<p>Terrible: temporary change to source code in order to test</p>
<h1>Leave the instrumenting code in there permanently?</h1>
<ul>
<li>bad performance in production</li>
<li>global variable interferes with other tests, concurrency</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              21/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>A very principled solution</h1></header>
            
            
            <section><p>Must do a lot of <em>refactoring</em> just to be able to test!</p>
<h1>Extract code in <code>our_module</code> into a class <code>OurMathClass</code></h1>
<p>(Note: this is Python 2.7 code)</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">OurMathClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return sum of x and y using clever algorithm.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return product of x and y using clever algorithm.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return double x.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              22/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Must refactor test case accordingly</h1></header>
            
            
            <section><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">our_math_class</span>

<span class="k">class</span> <span class="nc">TestOurMathClass</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">our_module</span> <span class="o">=</span> <span class="n">our_math_class</span><span class="o">.</span><span class="n">OurMathClass</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_our_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Our addition function should work on 2 and 3.&quot;&quot;&quot;</span>

        <span class="c"># arrange</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="c"># act; assert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">our_module</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">expected_result</span><span class="p">)</span>

    <span class="c"># Another test in same test case.</span>
    <span class="k">def</span> <span class="nf">test_our_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Our multiply function should work on 3 and 4.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">our_module</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              23/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Subclass <code>OurMathClass</code> to spy</h1></header>
            
            
            <section><p>Use overriding:</p>
<p>(Note: this is Python 2.7 code)</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">our_math_class</span> <span class="kn">import</span> <span class="n">OurMathClass</span>

<span class="k">class</span> <span class="nc">OurSpyingMathClass</span><span class="p">(</span><span class="n">OurMathClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiply_call_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c"># Override</span>
    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return product of x and y while spying.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiply_call_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># Python 2.7 classes</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">OurSpyingMathClass</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              24/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Replace <code>OurMathClass</code> with spy class</h1></header>
            
            
            <section><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">our_module</span> <span class="o">=</span> <span class="n">our_spying_math_class</span><span class="o">.</span><span class="n">OurSpyingMathClass</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_our_double_with_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Our double function should not work by multiplying.&quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">our_module</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">our_module</span><span class="o">.</span><span class="n">multiply_call_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

<p>Test finally runs!</p>
<div class="highlight"><pre><span class="gp">$</span> python -m unittest test_our_spying_math_class
<span class="go">.F.</span>
<span class="go">======================================================================</span>
<span class="go">FAIL: test_our_double_with_multiply (test_our_spying_math_class.TestOurSpyingMathClass)</span>
<span class="go">Our double function should not work by multiplying.</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;test_our_spying_math_class.py&quot;, line 29, in test_our_double_with_multiply</span>
<span class="go">    self.assertEqual(self.our_module.multiply_call_count, 0)</span>
<span class="go">AssertionError: 1 != 0</span>

<span class="go">----------------------------------------------------------------------</span>
<span class="go">Ran 3 tests in 0.000s</span>

<span class="go">FAILED (failures=1)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              25/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Summary of principled approach</h1></header>
            
            
            <section><ul>
<li>much <em>refactoring</em> just to be able to test</li>
<li>subclassing, overriding</li>
<li>custom <em>fake object</em> operating as <em>test spy</em></li>
<li>very clean</li>
</ul>
<p>I actually like this principled approach.</p>
<h1>Drawbacks of non-mock approach</h1>
<ul>
<li>invasive: often requires global redesign</li>
<li>we may not always be able to modify someone else's code we use</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              26/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Solution using patching</h1></header>
            
            
            <section><h2>We write new test designed to fail, <em>asserting on behavior</em>.</h2>
<p>Use <code>patch</code> decorator: patch existing function in dynamic context.</p>
<div class="highlight"><pre><span class="nd">@mock.patch</span><span class="p">(</span><span class="s">&#39;our_module.multiply&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_our_double_with_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fake_multiply</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Our double function should not work by multiplying.&quot;&quot;&quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">our_module</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fake_multiply</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

<p>It fails because <code>fake_multiply.call_count</code> is in fact <code>1</code>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              27/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>A better doubling algorithm</h1></header>
            
            
            <section><p>The redesigned doubling algorithm:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return double x using clever algorithm.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

<p>This passes the test.</p>
<p>Lessons:</p>
<ul>
<li><em>no need</em> to change any implementation code in order to test</li>
<li>a test spy is a very powerful tool!</li>
</ul>
<p>Drawbacks:</p>
<ul>
<li><code>mock</code> does scary monkey patching behind the scenes; be warned, in complex and corner cases</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              28/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Example: don't want to send email</h1></header>
            
            
            <section><p>Want to add to <code>OurMathClass</code>: a function <code>divide</code> such that dividing <code>N</code> by <code>0</code> results in sending email to <code>zerowatcherN@foo.com</code></p>
<h2>Start with new test in <code>test_our_math_class.py</code></h2>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">test_our_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dividing by zero should result in email being sent.&quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">our_math_class</span><span class="o">.</span><span class="n">OurMathClass</span><span class="p">,</span> <span class="s">&#39;mail&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mail</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">our_module</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mail</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s">&#39;zerowatcher5@foo.com&#39;</span><span class="p">)</span>
</pre></div>

<ul>
<li>patch out the method <code>mail</code>: avoid sending real email!</li>
<li>only care about the <em>behavior</em> that the mailer was called</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              29/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Isolation: divide without emailing</h1></header>
            
            
            <section><p>Note that our test passes without having yet implemented the mailer.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return division of x and y, sending email if y is 0.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mail</span><span class="p">(</span><span class="s">&#39;zerowatcher&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;@foo.com&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>

<span class="c"># TODO implement</span>
<span class="k">def</span> <span class="nf">mail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Email a message.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

<p>Used the mock for <em>isolation</em>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              30/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Other examples</h1></header>
            
            
            <section><p>Other functionality one might want to patch out:</p>
<ul>
<li>printing to a display</li>
<li>outputting to GUI</li>
<li>receiving input from the network</li>
<li>accessing a database</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              31/32
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: mock.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Conclusion</h1></header>
            
            
            <section><ul>
<li>test doubles are a powerful way to isolate tests</li>
<li>Python <code>mock</code> provides flexible test spies</li>
<li>other possible designs may reduce need for mocks</li>
</ul>
<p><em>Franklin Chen</em></p>
<p><a href="http://franklinchen.com/"><code>http://franklinchen.com/</code></a></p>
<p><a href="mailto:franklinchen@franklinchen.com"><code>franklinchen@franklinchen.com</code></a></p>
<p>This slideshow: <a href="http://franklinchen.com/talk-on-python-mock"><code>http://franklinchen.com/talk-on-python-mock</code></a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="mock.md">mock.md</a>
            </aside>
            
            <aside class="page_number">
              32/32
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Testing with isolation: concepts and examples using the <a href="http://www.voidspace.org.uk/python/mock/">Python standard library <code>mock</code></a> <br> <i>Franklin Chen</i> <br> <i><a href="http://franklinchen.com/">http://franklinchen.com/</a></i> <br> <a href="http://www.meetup.com/pghpython/">Pittsburgh Python</a> <br> October 23, 2012</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">Why this talk?</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">Mocks: controversial</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">Outline of presentation</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">Types of tests</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">Focus on unit testing</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7"><code>unittest</code> example</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">Running the unit test</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9"><a href="http://en.wikipedia.org/wiki/Test-driven_development">Test-driven development (TDD)</a></a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">Implementing our module</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">Rerunning tests</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">Skipping tests</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Fixing the bug</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">Repeat process: do <code>multiply</code></a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">What are test doubles?</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">Introduction to Python <code>mock</code></a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">Basic ideas of <code>mock</code></a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">More examples of spying</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">Controlled patching</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">Testing behavior without patching</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide21">A terrible solution</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide22">A very principled solution</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide23">Must refactor test case accordingly</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide24">Subclass <code>OurMathClass</code> to spy</a></th>
        <td><a href="#slide24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide25">Replace <code>OurMathClass</code> with spy class</a></th>
        <td><a href="#slide25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide26">Summary of principled approach</a></th>
        <td><a href="#slide26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide27">Solution using patching</a></th>
        <td><a href="#slide27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide28">A better doubling algorithm</a></th>
        <td><a href="#slide28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide29">Example: don't want to send email</a></th>
        <td><a href="#slide29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide30">Isolation: divide without emailing</a></th>
        <td><a href="#slide30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide31">Other examples</a></th>
        <td><a href="#slide31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide32">Conclusion</a></th>
        <td><a href="#slide32">32</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Expos</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>